<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Orçamento Pessoal</title>
  <!-- Tailwind via CDN para estilizar rapidamente -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React e ReactDOM via CDN: não precisa instalar nada -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Pequeno ajuste para inputs numéricos no mobile */
    input[type=number] { -moz-appearance: textfield; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div id="root" class="max-w-4xl mx-auto p-4 md:p-8"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // Utilidades simples
    const fmtBRL = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    const yyyymm = (dateStr) => {
      const d = new Date(dateStr);
      if (isNaN(d)) return '';
      return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    };

    const CATEGORIAS_PADRAO = [
      'Alimentação','Transporte','Moradia','Lazer','Saúde','Educação','Serviços','Outros'
    ];

    function useLocalStorage(key, valorInicial) {
      const [valor, setValor] = useState(() => {
        try {
          const bruto = localStorage.getItem(key);
          return bruto ? JSON.parse(bruto) : valorInicial;
        } catch { return valorInicial; }
      });
      useEffect(() => {
        try { localStorage.setItem(key, JSON.stringify(valor)); } catch {}
      }, [key, valor]);
      return [valor, setValor];
    }

    function Header() {
      return (
        <header className="mb-6">
          <h1 className="text-2xl md:text-3xl font-bold">Calculadora de Orçamento Pessoal</h1>
          <p className="text-slate-600">Registre suas despesas e veja o resumo mensal. (Dados salvos no seu navegador)</p>
        </header>
      );
    }

    function NovaDespesaForm({ onAdd, categorias }) {
      const hoje = new Date().toISOString().slice(0,10);
      const [descricao, setDescricao] = useState('');
      const [valor, setValor] = useState('');
      const [categoria, setCategoria] = useState(categorias[0] || 'Outros');
      const [data, setData] = useState(hoje);

      function handleSubmit(e){
        e.preventDefault();
        const valorNum = Number(valor.toString().replace(',', '.'));
        if(!descricao.trim()) return alert('Descrição é obrigatória.');
        if(!valorNum || valorNum <= 0) return alert('Informe um valor válido.');
        if(!data) return alert('Selecione a data.');
        onAdd({ id: crypto.randomUUID(), descricao: descricao.trim(), valor: valorNum, categoria, data });
        setDescricao(''); setValor(''); setCategoria(categorias[0] || 'Outros'); setData(hoje);
      }

      return (
        <form onSubmit={handleSubmit} className="grid gap-3 md:grid-cols-5 bg-white p-4 rounded-2xl shadow">
          <input
            className="md:col-span-2 border rounded-xl px-3 py-2 focus:outline-none focus:ring w-full"
            placeholder="Descrição (ex: Mercado)"
            value={descricao}
            onChange={(e)=>setDescricao(e.target.value)}
          />
          <input
            type="number" step="0.01" min="0"
            className="border rounded-xl px-3 py-2 focus:outline-none focus:ring w-full"
            placeholder="Valor (ex: 120.50)"
            value={valor}
            onChange={(e)=>setValor(e.target.value)}
          />
          <select
            className="border rounded-xl px-3 py-2 focus:outline-none focus:ring w-full"
            value={categoria}
            onChange={(e)=>setCategoria(e.target.value)}
          >
            {categorias.map((c)=>(<option key={c} value={c}>{c}</option>))}
          </select>
          <input
            type="date"
            className="border rounded-xl px-3 py-2 focus:outline-none focus:ring w-full"
            value={data}
            onChange={(e)=>setData(e.target.value)}
          />
          <button type="submit" className="md:col-span-5 md:justify-self-end bg-slate-900 text-white px-4 py-2 rounded-xl hover:opacity-90">
            Adicionar
          </button>
        </form>
      );
    }

    function FiltroMes({ mes, setMes }){
      // mes formato YYYY-MM
      const hoje = new Date();
      const atual = `${hoje.getFullYear()}-${String(hoje.getMonth()+1).padStart(2,'0')}`;
      useEffect(()=>{ if(!mes) setMes(atual); }, []);
      return (
        <div className="flex items-center gap-3">
          <label className="text-sm text-slate-600">Mês:</label>
          <input type="month" value={mes || ''} onChange={(e)=>setMes(e.target.value)} className="border rounded-xl px-3 py-2"/>
        </div>
      );
    }

    function TabelaDespesas({ itens, onDelete }){
      if(itens.length===0) return (
        <div className="text-center text-slate-500">Nenhuma despesa para este mês.</div>
      );
      return (
        <div className="overflow-x-auto">
          <table className="w-full text-left bg-white rounded-2xl shadow overflow-hidden">
            <thead className="bg-slate-100">
              <tr>
                <th className="px-4 py-3">Data</th>
                <th className="px-4 py-3">Descrição</th>
                <th className="px-4 py-3">Categoria</th>
                <th className="px-4 py-3">Valor</th>
                <th className="px-4 py-3">Ações</th>
              </tr>
            </thead>
            <tbody>
              {itens.map(item => (
                <tr key={item.id} className="border-t">
                  <td className="px-4 py-2">{new Date(item.data).toLocaleDateString('pt-BR')}</td>
                  <td className="px-4 py-2">{item.descricao}</td>
                  <td className="px-4 py-2">{item.categoria}</td>
                  <td className="px-4 py-2 font-medium">{fmtBRL(item.valor)}</td>
                  <td className="px-4 py-2">
                    <button onClick={()=>onDelete(item.id)} className="text-red-600 hover:underline">Excluir</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }

    function CartoesResumo({ totalMes, porCategoria }){
      return (
        <div className="grid md:grid-cols-3 gap-4">
          <div className="bg-white rounded-2xl shadow p-4">
            <p className="text-slate-500">Gasto total no mês</p>
            <p className="text-2xl font-bold">{fmtBRL(totalMes)}</p>
          </div>
          <div className="md:col-span-2 bg-white rounded-2xl shadow p-4">
            <p className="text-slate-500 mb-2">Por categoria</p>
            <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-2">
              {Object.entries(porCategoria).map(([cat, val]) => (
                <div key={cat} className="border rounded-xl px-3 py-2 flex justify-between">
                  <span>{cat}</span>
                  <span className="font-medium">{fmtBRL(val)}</span>
                </div>
              ))}
              {Object.keys(porCategoria).length===0 && (
                <div className="text-slate-500">Sem dados no mês.</div>
              )}
            </div>
          </div>
        </div>
      );
    }

    function App(){
      const [despesas, setDespesas] = useLocalStorage('despesas-v1', []);
      const [categorias, setCategorias] = useLocalStorage('categorias-v1', CATEGORIAS_PADRAO);
      const [mes, setMes] = useState(''); // yyyy-mm

      const despesasDoMes = useMemo(()=>despesas.filter(d => yyyymm(d.data) === mes), [despesas, mes]);
      const totalMes = useMemo(()=>despesasDoMes.reduce((acc, d) => acc + d.valor, 0), [despesasDoMes]);
      const porCategoria = useMemo(()=>{
        const mapa = {};
        for(const d of despesasDoMes){
          mapa[d.categoria] = (mapa[d.categoria] || 0) + d.valor;
        }
        return mapa;
      }, [despesasDoMes]);

      function adicionarDespesa(nova){ setDespesas(prev => [nova, ...prev]); }
      function excluirDespesa(id){ setDespesas(prev => prev.filter(d => d.id !== id)); }

      function adicionarCategoria(){
        const nome = prompt('Nome da nova categoria:')?.trim();
        if(!nome) return;
        if(categorias.includes(nome)) return alert('Categoria já existe.');
        setCategorias([...categorias, nome]);
      }

      function limparTudo(){
        if(confirm('Tem certeza que deseja limpar TODAS as despesas?')){
          setDespesas([]);
        }
      }

      return (
        <main className="space-y-6">
          <Header />

          <section className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <FiltroMes mes={mes} setMes={setMes} />
            <div className="flex gap-2">
              <button onClick={adicionarCategoria} className="border px-3 py-2 rounded-xl">+ Categoria</button>
              <button onClick={limparTudo} className="border px-3 py-2 rounded-xl">Limpar tudo</button>
            </div>
          </section>

          <NovaDespesaForm onAdd={adicionarDespesa} categorias={categorias} />

          <CartoesResumo totalMes={totalMes} porCategoria={porCategoria} />

          <section className="bg-white rounded-2xl shadow p-4 space-y-3">
            <h2 className="text-xl font-semibold">Despesas do mês</h2>
            <TabelaDespesas itens={despesasDoMes} onDelete={excluirDespesa} />
          </section>

          <footer className="text-center text-xs text-slate-400 pt-4">
            Feito com React + Tailwind. Seus dados ficam somente no seu navegador (localStorage).
          </footer>
        </main>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>

